---
title: Version Feature Validation
description: 'Automatic validation of JSON Schema version compatibility and feature support'
icon: 'ticket-check'
---

The package automatically validates that schema features are compatible with the specified JSON Schema version, preventing runtime errors and ensuring schema portability across different validators.

## Automatic Feature Validation

When you use features that require specific JSON Schema versions, the package automatically validates compatibility:

```php
use Cortex\JsonSchema\Schema;
use Cortex\JsonSchema\Enums\SchemaVersion;
use Cortex\JsonSchema\Exceptions\SchemaException;

// ✅ This works - deprecated is supported in Draft 2019-09+
$modernSchema = Schema::string('legacy_field', SchemaVersion::Draft_2019_09)
    ->deprecated()
    ->comment('Use new_field instead');

// ❌ This throws an exception - deprecated requires Draft 2019-09+
try {
    $invalidSchema = Schema::string('legacy_field', SchemaVersion::Draft_07)
        ->deprecated(); // SchemaException thrown here
} catch (SchemaException $e) {
    echo $e->getMessage();
    // "Feature 'Property deprecation annotation' is not supported in Draft 7.
    //  Minimum version required: Draft 2019-09."
}
```

## Feature Support Matrix

Understanding which features are available in each JSON Schema version:

### Core Validation (All Versions)

```php
// These features work in all supported versions
$basicSchema = Schema::object('basic', SchemaVersion::Draft_07)
    ->properties(
        Schema::string('name')
            ->minLength(2)
            ->maxLength(100)
            ->pattern('^[A-Za-z\s]+$')
            ->required(),
        Schema::integer('age')
            ->minimum(0)
            ->maximum(150)
            ->required(),
        Schema::array('tags')
            ->items(Schema::string())
            ->minItems(1)
            ->maxItems(10)
            ->uniqueItems(true)
    )
    ->additionalProperties(false);
```

### Conditional Logic (Draft-07+)

```php
// if/then/else works in Draft-07 and later
$conditionalSchema = Schema::object('user', SchemaVersion::Draft_07)
    ->properties(
        Schema::string('type')->enum(['personal', 'business']),
        Schema::string('company_name'),
        Schema::string('tax_id')
    )
    ->if(
        Schema::object()->properties(
            Schema::string('type')->const('business')
        )
    )
    ->then(
        Schema::object()->properties(
            Schema::string('company_name')->required(),
            Schema::string('tax_id')->required()
        )
    );
```

### Draft 2019-09 Features

```php
// Advanced features requiring Draft 2019-09+
$modernSchema = Schema::object('modern_user', SchemaVersion::Draft_2019_09)
    ->properties(
        Schema::string('name')->required(),
        Schema::string('email')->required(),

        // Deprecated annotation
        Schema::string('old_email')
            ->deprecated()
            ->comment('Use email field instead'),

        // Array contains validation
        Schema::array('roles')
            ->items(Schema::string())
            ->minContains(1)    // At least one role required
            ->maxContains(5),   // Maximum 5 roles

        // Extended format support
        Schema::string('id')
            ->format(SchemaFormat::Uuid),

        Schema::string('session_duration')
            ->format(SchemaFormat::Duration)
    )
    // Unevaluated properties
    ->unevaluatedProperties(false)

    // Dependent schemas
    ->dependentSchema('old_email',
        Schema::object()
            ->if(Schema::object()->properties(
                Schema::string('old_email')->minLength(1)
            ))
            ->then(Schema::object()
                ->properties(
                    Schema::string('migration_date')
                        ->format(SchemaFormat::Date)
                        ->required()
                )
            )
    );
```

### Draft 2020-12 Features

```php
// Cutting-edge features in Draft 2020-12
$latestSchema = Schema::array('tuple_array', SchemaVersion::Draft_2020_12)
    // Prefix items for tuple validation
    ->prefixItems([
        Schema::string()->description('Name'),
        Schema::integer()->minimum(0)->description('Age'),
        Schema::boolean()->description('Active status')
    ])
    // Additional items after prefix
    ->items(Schema::string()->description('Additional info'))
    // Unevaluated items control
    ->unevaluatedItems(false);
```
